<Window x:Class="uchat_gui.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:uchat_gui"
        Title="uChat"
        Height="600"
        Width="900"
        MinHeight="400"
        MinWidth="600"
        WindowStartupLocation="CenterScreen"
        Background="#F5F5F5">

    <Window.Resources>
        <Style TargetType="Button">
            <Setter Property="Padding" Value="12,6"/>
            <Setter Property="Margin" Value="4"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="FontSize" Value="13"/>
        </Style>
        
        <Style TargetType="TextBox">
            <Setter Property="Padding" Value="8"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="BorderBrush" Value="#CCCCCC"/>
        </Style>
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- === STATUS BAR === -->
        <Border Grid.Row="0" 
                Background="#E8E8E8" 
                Padding="10,8"
                BorderThickness="0,0,0,1"
                BorderBrush="#CCCCCC">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <StackPanel Orientation="Horizontal" Grid.Column="0">
                    <Ellipse x:Name="StatusIndicator" 
                            Width="10" 
                            Height="10" 
                            Margin="0,0,8,0"
                            Fill="Green"
                            VerticalAlignment="Center"/>
                    <TextBlock x:Name="StatusText" 
                              Text="Connected" 
                              VerticalAlignment="Center"
                              FontSize="12"/>
                </StackPanel>

                <StackPanel Grid.Column="2" Orientation="Horizontal">
                    <TextBlock x:Name="SelectedUserText"
                              Text=""
                              FontWeight="SemiBold"
                              VerticalAlignment="Center"
                              FontSize="12"
                              Margin="0,0,10,0"
                              Visibility="Collapsed"/>
                    <TextBlock x:Name="CurrentUserText" 
                          FontWeight="SemiBold"
                          VerticalAlignment="Center"
                          FontSize="12"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- === MAIN CONTENT AREA === -->
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="250"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- === LEFT PANEL: CONTACTS === -->
            <Border Grid.Column="0"
                    Background="White"
                    BorderThickness="0,0,1,0"
                    BorderBrush="#CCCCCC">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <TextBlock Text="Contacts" 
                              Grid.Row="0"
                              FontWeight="Bold"
                              FontSize="14"
                              Padding="12,12"
                              Background="#F8F8F8"/>

                    <ListBox x:Name="UsersList"
                            Grid.Row="1"
                            BorderThickness="0"
                            SelectionMode="Single"
                            SelectionChanged="UsersList_SelectionChanged"
                            ContextMenuOpening="UsersList_ContextMenuOpening">
                        <ListBox.ItemContainerStyle>
                            <Style TargetType="ListBoxItem">
                                <Setter Property="Padding" Value="12,8"/>
                                <Setter Property="Margin" Value="4,2"/>
                                <Setter Property="Background" Value="Transparent"/>
                                <Style.Triggers>
                                    <Trigger Property="IsSelected" Value="True">
                                        <Setter Property="Background" Value="#E3F2FD"/>
                                        <Setter Property="FontWeight" Value="SemiBold"/>
                                    </Trigger>
                                    <Trigger Property="IsMouseOver" Value="True">
                                        <Setter Property="Background" Value="#F5F5F5"/>
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </ListBox.ItemContainerStyle>
                        <ListBox.ContextMenu>
                            <ContextMenu>
                                <MenuItem x:Name="RenameRoomMenuItem" 
                                         Header="Rename Room" 
                                         Click="RenameRoomMenuItem_Click"
                                         Visibility="Collapsed"/>
                                <MenuItem x:Name="ViewMembersMenuItem" 
                                         Header="View Members" 
                                         Click="ViewMembersMenuItem_Click"
                                         Visibility="Collapsed"/>
                                <Separator/>
                                <MenuItem x:Name="KickUserMenuItem" 
                                         Header="Kick User..." 
                                         Click="KickUserMenuItem_Click"
                                         Visibility="Collapsed"/>
                                <Separator/>
                                <MenuItem x:Name="LeaveRoomMenuItem" 
                                         Header="Leave Room" 
                                         Click="LeaveRoomMenuItem_Click"
                                         Visibility="Collapsed"/>
                                <MenuItem x:Name="DeleteRoomMenuItem" 
                                         Header="Delete Room" 
                                         Click="DeleteRoomMenuItem_Click"
                                         Visibility="Collapsed"/>
                            </ContextMenu>
                        </ListBox.ContextMenu>
                    </ListBox>

                    <StackPanel Grid.Row="2" 
                               Orientation="Vertical"
                               Margin="8">
                        <Button Content="All Users" 
                               Margin="0,0,0,4"
                               Click="AllUsers_Click"/>
                        <Button Content="➕ Create Room" 
                               Margin="0,0,0,4"
                               Click="CreateRoom_Click"/>
                        <Button Content="🔍 Join Room" 
                               Click="JoinRoom_Click"/>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- === RIGHT PANEL: CHAT === -->
            <Grid Grid.Column="1">
                <Grid.RowDefinitions>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- Chat history -->
                <ScrollViewer x:Name="ChatScrollViewer"
                             VerticalScrollBarVisibility="Auto"
                             HorizontalScrollBarVisibility="Disabled"
                             Padding="10"
                             Background="White">
                    <ItemsControl x:Name="ChatItemsControl">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <StackPanel Orientation="Vertical"/>
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <local:MessageBubble 
                                    SenderName="{Binding Sender, Mode=OneWay}"
                                    MessageText="{Binding Text, Mode=OneWay}"
                                    Timestamp="{Binding Time, Mode=OneWay}"
                                    IsOwnMessage="{Binding IsOwnMessage, Mode=OneWay}"
                                    MessageId="{Binding Id, Mode=OneWay}"
                                    IsFileMessage="{Binding Item.IsFileMessage, Mode=OneWay}"
                                    FilePath="{Binding Item.FilePath, Mode=OneWay}"
                                    Tag="{Binding}"
                                    Loaded="MessageBubble_Loaded"/>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>
            </Grid>
        </Grid>

        <!-- === BOTTOM PANEL: INPUT AREA === -->
        <Border Grid.Row="2"
                Background="White"
                BorderThickness="0,1,0,0"
                BorderBrush="#CCCCCC"
                Padding="10">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Edit mode indicator -->
                <TextBlock x:Name="EditModeIndicator"
                          Grid.Row="0"
                          Text="Editing message..."
                          Foreground="#0078D4"
                          FontSize="11"
                          Margin="0,0,0,4"
                          Visibility="Collapsed"/>

                <!-- Input controls -->
                <Grid Grid.Row="1">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <!-- Attach File Button -->
                    <Button x:Name="AttachFileButton"
                           Grid.Column="0"
                           Content="📎 Attach"
                           Width="90"
                           Click="SendFile_Click"
                           ToolTip="Attach and send a file"/>

                    <!-- Message Input -->
                    <TextBox x:Name="InputBox"
                            Grid.Column="1"
                            MinHeight="36"
                            MaxHeight="120"
                            TextWrapping="Wrap"
                            AcceptsReturn="True"
                            VerticalScrollBarVisibility="Auto"
                            KeyDown="InputBox_KeyDown"/>

                    <!-- Send Button -->
                    <Button x:Name="SendButton"
                           Grid.Column="2"
                           Content="Send"
                           Width="80"
                           Click="Send_Click"
                           IsDefault="True"/>

                    <!-- Edit/Delete buttons (shown when message selected) -->
                    <StackPanel x:Name="EditDeletePanel"
                               Grid.Column="3"
                               Orientation="Horizontal"
                               Visibility="Collapsed">
                        <Button Content="✏️ Edit"
                               Width="70"
                               Click="Edit_Click"
                               ToolTip="Edit selected message"/>
                        <Button Content="🗑️ Delete"
                               Width="70"
                               Click="Delete_Click"
                               ToolTip="Delete selected message"/>
                    </StackPanel>
                </Grid>
            </Grid>
        </Border>
    </Grid>
</Window>
